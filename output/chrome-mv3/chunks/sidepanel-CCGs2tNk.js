import{c as v,r as o,j as e,b as x,B as H,R as C}from"./tailwind-D7pjOgzZ.js";import{G as E,S as L,M as D,T as A,j as P,k as I,K as R,l as z,D as _,q as B,E as F,r as q,s as b,t as W}from"./dropdown-menu-DGHFiHgs.js";import{H as $}from"./highlighter-D7aD7r60.js";import{T as G}from"./triangle-alert-CfFhC-gb.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],K=v("eye",O);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],J=v("refresh-cw",V),Q={theme:"system",setTheme:()=>null},N=o.createContext(Q);function X({children:s,defaultTheme:a="system",storageKey:h="vite-ui-theme",...l}){const[n,g]=o.useState(()=>localStorage.getItem(h)||a);o.useEffect(()=>{const c=window.document.documentElement;if(c.classList.remove("light","dark"),n==="system"){const y=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";c.classList.add(y);return}c.classList.add(n)},[n]);const p={theme:n,setTheme:c=>{localStorage.setItem(h,c),g(c)}};return e.jsx(N.Provider,{...l,value:p,children:s})}const Y=()=>{const s=o.useContext(N);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s};function Z({activeUrl:s,loading:a,loadWebsiteHighlights:h}){const{setTheme:l,theme:n}=Y(),g=s?`https://www.google.com/s2/favicons?domain=${new URL(s).hostname}&sz=64`:"";return e.jsxs("div",{className:"flex items-center justify-between gap-3 w-full px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-sm mb-3 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:s?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:g,alt:"favicon",className:"w-4 h-4 rounded-sm flex-shrink-0"}),e.jsx("a",{href:s,target:"_blank",rel:"noreferrer",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline truncate max-w-[200px] sm:max-w-[300px] md:max-w-[400px] lg:max-w-[500px]",title:s,children:s})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm italic",children:"No active tab"})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:h,disabled:a,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 active:scale-[0.97] transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(J,{className:`w-4 h-4 ${a?"animate-spin text-amber-500":"text-gray-600 dark:text-gray-200"}`}),a?"Refreshing":"Refresh"]}),e.jsx("button",{onClick:()=>l(n==="light"?"dark":"light"),className:"p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition active:scale-[0.97]",title:n=="dark"?"Switch to Light Mode":"Switch to Dark Mode",children:n=="dark"?e.jsx(L,{className:"w-4 h-4 text-yellow-400"}):e.jsx(D,{className:"w-4 h-4 text-gray-700"})})]})]})}const U=()=>{const[s,a]=o.useState([]),[h,l]=o.useState([]),[n,g]=o.useState(!0),[p,c]=o.useState(""),[y,w]=o.useState(null),k=async t=>{try{w(t);const r=await x.runtime.sendMessage({action:"deleteSingleHighlight",data:t});r.success?(await x.runtime.sendMessage({action:"deleteHighlightFromDocumentToBgScript",data:t}),a(i=>i.filter(d=>d.id!==t)),l(i=>i.filter(d=>d.id!==t))):console.error("Failed to delete highlight:",r.error)}catch(r){console.error("Error deleting highlight:",r)}finally{w(null)}},f=async()=>{try{g(!0);const r=(await x.tabs.query({active:!0,currentWindow:!0}))[0];if(!(r!=null&&r.url)){a([]),l([]),c(""),g(!1);return}l([]),c(r.url);const i=await x.runtime.sendMessage({action:"getWebsiteHighlights",data:r.url});if(i!=null&&i.success){const d=(i.data||[]).sort((u,m)=>new Date(m.createdAt).getTime()-new Date(u.createdAt).getTime());a(d)}else a([])}catch(t){console.error("Error loading website highlights:",t),a([]),l([])}finally{g(!1)}};o.useEffect(()=>{f();const t=r=>{r.action==="invalidateSidepanelHighlights"&&f(),r.action==="lostHighlights"&&Array.isArray(r.data)&&a(i=>{const d=[],u=[];return i.forEach(m=>{r.data.includes(m.id)?d.push(m):u.push(m)}),d.length>0&&l(m=>[...m,...d.filter(M=>!m.find(S=>S.id===M.id))]),u})};return x.runtime.onMessage.addListener(t),()=>x.runtime.onMessage.removeListener(t)},[]);const T=async t=>{try{await x.runtime.sendMessage({action:"scrollToHighlight",data:t})}catch(r){console.error("Error scrolling to highlight:",r)}},j=(t,r=!1)=>e.jsxs("div",{className:"bg-background group rounded-md border flex overflow-hidden",children:[e.jsx("div",{className:"w-2",style:{background:(t==null?void 0:t.color)||"yellow"}}),e.jsxs("div",{className:"flex-1 p-3 flex flex-col gap-1 w-full overflow-auto",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-sm tracking-wide font-medium flex-1 pr-2 break-words whitespace-pre-wrap",children:t.selectionString}),e.jsxs(_,{children:[e.jsx(B,{asChild:!0,children:e.jsx(H,{variant:"ghost",size:"icon-sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:i=>i.stopPropagation(),children:e.jsx(F,{className:"h-4 w-4"})})}),e.jsxs(q,{align:"end",className:"w-36",children:[!r&&e.jsxs(b,{onClick:()=>{T(t.id)},children:[e.jsx(K,{className:"mr-2 h-4 w-4"})," Show"]}),e.jsxs(b,{onClick:()=>{k(t.id)},className:"text-destructive focus:text-destructive",children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-snug mt-1 ml-6 break-all whitespace-pre-wrap",children:(t==null?void 0:t.notes)||""})]})]},t.id);return e.jsxs("div",{className:"p-2",children:[e.jsx(Z,{activeUrl:p,loading:n,loadWebsiteHighlights:f}),n?e.jsx("p",{className:"text-center text-gray-400 italic mt-4",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx($,{size:16})," Highlights"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.length," total"]})]}),s.length===0?e.jsx("p",{className:"text-center text-gray-500 italic",children:"No highlights yet."}):e.jsx("ul",{className:"space-y-3",children:s.map(t=>j(t,!1))})]}),h.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-base font-semibold text-red-600 flex items-center gap-2",children:[e.jsx(G,{size:16})," Lost Highlights",e.jsx(A,{children:e.jsxs(P,{children:[e.jsx(I,{asChild:!0,children:e.jsx(R,{size:15,className:"text-gray-500 hover:text-gray-700 cursor-pointer"})}),e.jsx(z,{side:"top",className:"max-w-xs text-sm",children:"The pageâ€™s content has changed since the highlights were created. This could be due to changes in the page structure or deleted highlights. Please try to highlight the text again."})]})})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[h.length," lost"]})]}),e.jsx("ul",{className:"space-y-3",children:h.map(t=>j(t,!0))})]})]})]})},ee=()=>e.jsx("div",{className:"p-2",children:e.jsx(U,{})}),te=o.createContext(void 0);function se({children:s}){return e.jsx(te.Provider,{value:{},children:s})}document.addEventListener("DOMContentLoaded",()=>{const s=x.i18n.getMessage("@@bidi_dir");document.body.setAttribute("dir",s)});C.createRoot(document.getElementById("root")).render(e.jsx(X,{defaultTheme:"light",storageKey:"vite-ui-theme",children:e.jsx(se,{children:e.jsx(ee,{})})}));
